# prefect.yaml
name: Trip stop tracking flow
prefect-version: 3.0.7

# Build section for Docker if needed
build: {}

# Push section for remote storage if needed
push: {}

# Pull section for deployment setup
pull:
  - prefect.deployments.steps.git_clone:
      repository: https://github.com/kfalconarkn/gtfs-bus-tracking.git
      branch: main
      id: clone-step
      access_token: "{{ $GITHUB_ACCESS_TOKEN }}"  # Reference to secret

  - prefect.deployments.steps.pip_install_requirements:
      directory: "{{ clone-step.directory }}"
      requirements_file: requirements.txt
      # Optional: you can specify extra packages here
      extra_pip_args: ["--no-cache-dir"]

# Deployments configuration
deployments:
  - name: "trip stop tracking floww"
    version: "0.0.1"
    tags: []
    description: "Trip stop tracking main flow"
    entrypoint: "gtfs_trip_etl.py:main_flow"  # Make sure this points to your flow
    work_pool:
      name: "Main"
      work_queue_name: "default"  # Specify a default queue
      job_variables:
        # Specify any environment variables or job-specific configs
        pip_extra_index_url: "https://pypi.org/simple"
        working_dir: "{{ clone-step.directory }}"

  - name: "trip stop data monitoring deployment"
    version: "1.0.0"
    description: "Monitoring deployment with schedule"
    entrypoint: "gtfs_trip_etl.py:main_flow"
    work_pool:
      name: "Main"
      work_queue_name: "default"
    schedules:
      - interval: 15
        anchor_date: "2024-11-01T05:22:35.191458+00:00"
        timezone: "UTC"
        active: true
    job_variables:
      # You can specify deployment-specific variables
      memory_limit: "2GB"
      pip_extra_index_url: "https://pypi.org/simple"
      working_dir: "{{ clone-step.directory }}"